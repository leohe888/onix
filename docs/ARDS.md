# ARDS

地址范围描述符结构（Address Range Descriptor Structure，ARDS）是一种用于描述内存地址范围的结构，大小为 20 字节。其结构如下：

| 偏移量 | 名称         | 长度   | 说明                           |
| ------ | ------------ | ------ | ------------------------------ |
| 0x00   | BaseAddrLow  | 4 字节 | 基址低 32 位                   |
| 0x04   | BaseAddrHigh | 4 字节 | 基址高 32 位                   |
| 0x08   | LengthLow    | 4 字节 | 区域长度低 32 位，以字节为单位 |
| 0x0C   | LengthHigh   | 4 字节 | 区域长度高 32 位，以字节为单位 |
| 0x10   | Type         | 4 字节 | 内存区域类型                   |

- Type 字段：

  | Type 值 | 名称                 | 描述                                                                                     |
  | ------- | -------------------- | ---------------------------------------------------------------------------------------- |
  | 1       | AddressRangeMemory   | 这段内存可以被操作系统使用                                                               |
  | 2       | AddressRangeReserved | 内存使用中或者被系统保留，操作系统不可以用此内存                                         |
  | 3       |                      | 存储 ACPI 表，可以被操作系统回收。                                                       |
  | 4       |                      | 操作系统不可使用这段内存。                                                               |
  | 5       |                      | 已经损坏的内存区域，不可使用。                                                           |
  | 其他    | 未定义               | 未定义，将来会用到，目前保留，但是需要操作系统一样将其视为 ARR（AddressRangeReserved）。 |

可以通过 BIOS 中断 `int 0x15, 0xe820` 来获取 ARDS 结构：

- 输入：
  - EAX = `0xe820` —— 功能号。
  - EBX = 连续调用值 —— 首次调用时设置为 `0`；后续调用使用 BIOS 返回的值。
  - ECX = ARDS 大小 —— 以字节为单位，一般为 `20`。
  - EDX = `0x534d4150` (即 "SMAP" 的 ASCII 码) —— 固定签名。
  - ES:DI = ARDS 缓存地址。

- 输出：
  - CF 位为 0 表示成功，为 1 表示失败。
  - EAX = `0x534d4150` (即 "SMAP" 的 ASCII 码)。
  - EBX = 连续调用值 —— 为 0 表示这是最后一个 ARDS，没有更多 ARDS 了。
  - ECX = BIOS 实际返回的 ARDS 大小 —— 以字节为单位，一般为 `20`。
  - ES:DI：和输入时的 ES:DI 相同。

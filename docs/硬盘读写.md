# 硬盘读写

## 硬盘接口

- IDE/ATA/PATA -> SATA
- SCSI -> SAS

## 寻址模式

### CHS 模式

- Cylinder：柱面。
- Head：磁头。
- Sector：扇区。

### LBA 模式

LBA，全称为 Logical Block Addressing，即逻辑块寻址。每个扇区都有一个唯一的编号（从 0 开始），这个编号就是 LBA 地址。LBA 地址长度可以是 28 位、48 位等。

### 读写端口

| 端口地址（主盘） | 端口地址（从盘） | 名称          | 位宽  | 读写方向 | 作用描述                                                                                                                                                |
| :--------------- | :--------------- | :------------ | :---- | :------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0x1F0            | 0x170            | 数据寄存器    | 16 位 | 读/写    | 用于读写数据                                                                                                                                            |
| 0x1F1            | 0x171            | 错误寄存器    | 8 位  | 读       | 包含上一次命令执行失败的错误代码                                                                                                                        |
|                  |                  | 特性寄存器    | 8 位  | 写       | 用于设置一些特定命令的额外特性                                                                                                                          |
| 0x1F2            | 0x172            | 扇区数量      | 8位   | 读/写    | 要读写的扇区数量，注意为 0 时表示 256 个                                                                                                                |
| 0x1F3            | 0x173            | LBA 低/扇区号 | 8 位  | 读/写    | LBA 的 0-7 位或 CHS 扇区号                                                                                                                              |
| 0x1F4            | 0x174            | LBA 中/柱面低 | 8 位  | 读/写    | LBA 的 8-15 位或柱面低字节                                                                                                                              |
| 0x1F5            | 0x175            | LBA 高/柱面高 | 8 位  | 读/写    | LBA 的 16-23 位或柱面高字节                                                                                                                             |
| 0x1F6            | 0x176            |               | 8 位  | 读/写    | Bit 0-3：LBA 24-27 位或磁头号<br/>Bit 4：0 表示主盘, 1 表示从盘)<br/>Bit 5：固定为 1<br/>Bit 6：0 表示 CHS 模式，1 表示 LBA 模式<br/>Bit 7：固定为 1    |
| 0x1F7            | 0x177            | 状态寄存器    | 8 位  | 读       | Bit 7：BUSY<br/>Bit 6：READY<br/>Bit 5：DEVICE FAULT<br/>Bit 4：SEEK COMPLETE<br/>Bit 3：DATA REQUEST (DRQ) 重要！表示数据已准备好传输<br/>Bit 0：ERROR |
|                  |                  | 命令寄存器    | 8 位  | 写       | 0x20 读扇区<br/>0x30 写扇区<br />0xEC：识别硬盘                                                                                                         |
